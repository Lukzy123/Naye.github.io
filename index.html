<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Graficador de Distribución Normal</title>
  <style>
    :root{--bg:#f7f9fb;--card:#ffffff;--accent:#e9a826;--muted:#666}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:0; padding:24px; color:#222}
    .container{max-width:980px; margin:0 auto; display:grid; grid-template-columns:360px 1fr; gap:20px; align-items:start}
    .card{background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(20,30,40,0.06)}
    h1{margin:0 0 8px; font-size:18px}
    label{display:block; font-size:13px; margin-top:10px; color:var(--muted)}
    input[type=number]{width:100%; padding:8px 10px; margin-top:6px; border-radius:8px; border:1px solid #ddd; font-size:14px}
    .row{display:flex; gap:10px}
    button{margin-top:14px; width:100%; background:var(--accent); color:#fff; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:600}
    .small{font-size:13px; color:var(--muted)}
    canvas{width:100%; height:420px; background:linear-gradient(180deg,#fff, #fcfcff); border-radius:10px}
    .legend{display:flex; gap:10px; align-items:center; margin-top:8px}
    .chip{display:inline-block; padding:6px 8px; border-radius:8px; background:#f1f3f5; font-size:13px}
    .footer{margin-top:12px; font-size:13px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Graficador — Distribución Normal</h1>
      <p class="small">Introduce los parámetros y presiona <strong>Graficar</strong>. Se pintará la curva normal, la media y el área a la izquierda de X.</p>

      <label>Media (μ)</label>
      <input id="mu" type="number" step="0.1" value="7">

      <label>Desviación estándar (σ)</label>
      <input id="sigma" type="number" step="0.1" value="2">

      <label>Valor X (punto a sombrear / P(X &lt; X))</label>
      <input id="xvalue" type="number" step="0.1" value="5">

      <label>Rango (± veces σ para graficar)</label>
      <input id="range" type="number" step="0.5" value="4">

      <button id="plotBtn">Graficar</button>

      <div class="legend">
        <span class="chip">μ — media</span>
        <span class="chip">σ — desviación</span>
        <span class="chip">Sombreado = P(X &lt; X)</span>
      </div>

      <div class="footer">Exporta la gráfica con clic derecho &rarr; Guardar imagen como...</div>
    </div>

    <div class="card">
      <canvas id="chart" width="800" height="420"></canvas>
      <div style="display:flex;justify-content:space-between;margin-top:8px;align-items:center">
        <div class="small">Gráfica de densidad normal</div>
        <div id="output" class="small">P(X &lt; x) = -</div>
      </div>
    </div>
  </div>

  <script>
    // Funciones estadísticas (PDF y CDF) usando la función error function (erf)
    function erf(x) {
      // Aproximación de Abramowitz y Stegun (muy precisa)
      var sign = (x >= 0) ? 1 : -1;
      x = Math.abs(x);
      var a1 =  0.254829592;
      var a2 = -0.284496736;
      var a3 =  1.421413741;
      var a4 = -1.453152027;
      var a5 =  1.061405429;
      var p  =  0.3275911;
      var t = 1.0/(1.0 + p*x);
      var y = 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*Math.exp(-x*x);
      return sign*y;
    }
    function normalPdf(x, mu, sigma){
      return Math.exp(-0.5*Math.pow((x-mu)/sigma,2)) / (sigma*Math.sqrt(2*Math.PI));
    }
    function normalCdf(x, mu, sigma){
      return 0.5*(1 + erf((x-mu)/(sigma*Math.sqrt(2))));
    }

    // Dibujo en canvas
    const canvas = document.getElementById('chart');
    const ctx = canvas.getContext('2d');

    function clear(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }

    function draw(mu, sigma, xvalue, rangeSigma){
      clear();
      // padding y sistema de coordenadas
      const pad = {l:60, r:20, t:30, b:50};
      const W = canvas.width - pad.l - pad.r;
      const H = canvas.height - pad.t - pad.b;

      const xmin = mu - rangeSigma*sigma;
      const xmax = mu + rangeSigma*sigma;

      // preparar puntos
      const N = 500;
      const xs = new Array(N);
      const ys = new Array(N);
      let ymax = 0;
      for(let i=0;i<N;i++){
        const xx = xmin + (xmax-xmin)*(i/(N-1));
        const yy = normalPdf(xx, mu, sigma);
        xs[i] = xx; ys[i] = yy;
        if(yy>ymax) ymax = yy;
      }

      // funciones de mapeo
      const x2px = x => pad.l + ( (x - xmin)/(xmax - xmin) )*W;
      const y2px = y => pad.t + H - (y / ymax)*H;

      // ejes
      ctx.strokeStyle = '#111'; ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(pad.l, pad.t+H); ctx.lineTo(pad.l+W, pad.t+H); ctx.stroke(); // eje x
      ctx.beginPath(); ctx.moveTo(pad.l, pad.t); ctx.lineTo(pad.l, pad.t+H); ctx.stroke(); // eje y

      // ticks x
      ctx.fillStyle='#222'; ctx.font='12px Inter, Arial'; ctx.textAlign='center';
      const ticks = 8;
      for(let i=0;i<=ticks;i++){
        const xv = xmin + (xmax-xmin)*(i/ticks);
        const px = x2px(xv);
        ctx.beginPath(); ctx.moveTo(px, pad.t+H); ctx.lineTo(px, pad.t+H+6); ctx.stroke();
        ctx.fillText(xv.toFixed(2), px, pad.t+H+20);
      }

      // ticks y (simple)
      ctx.textAlign='right'; ctx.font='12px Inter, Arial';
      for(let i=0;i<=4;i++){
        const yy = ymax*(i/4);
        const py = y2px(yy);
        ctx.beginPath(); ctx.moveTo(pad.l-6, py); ctx.lineTo(pad.l, py); ctx.stroke();
        ctx.fillText(yy.toFixed(3), pad.l-8, py+4);
      }

      // sombrear área x <= xvalue
      ctx.beginPath();
      // empezar desde x = xmin en la base
      ctx.moveTo(x2px(xmin), y2px(0));
      for(let i=0;i<N;i++){
        if(xs[i] <= xvalue){
          ctx.lineTo(x2px(xs[i]), y2px(ys[i]));
        }
      }
      // si xvalue > xmin, añadir punto en xvalue
      if(xvalue > xmin){
        ctx.lineTo(x2px(xvalue), y2px(0));
      }
      ctx.closePath();
      ctx.fillStyle = 'rgba(233,168,38,0.25)';
      ctx.fill();

      // dibujar curva
      ctx.beginPath();
      ctx.lineWidth = 3; ctx.strokeStyle = '#e9a826';
      for(let i=0;i<N;i++){
        const px = x2px(xs[i]), py = y2px(ys[i]);
        if(i===0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
      }
      ctx.stroke();

      // línea media
      ctx.beginPath(); ctx.setLineDash([6,6]); ctx.strokeStyle='#d95d39'; ctx.lineWidth=2;
      const mpx = x2px(mu); ctx.moveTo(mpx, pad.t); ctx.lineTo(mpx, pad.t+H); ctx.stroke(); ctx.setLineDash([]);

      // línea X seleccionada
      ctx.beginPath(); ctx.strokeStyle='#2b7bdc'; ctx.lineWidth=2;
      const xpx = x2px(xvalue); ctx.moveTo(xpx, pad.t); ctx.lineTo(xpx, pad.t+H); ctx.stroke();

      // anotaciones
      ctx.fillStyle='#222'; ctx.font='14px Inter, Arial'; ctx.textAlign='left';
      ctx.fillText(`μ = ${mu}    σ = ${sigma}    X = ${xvalue}`, pad.l, pad.t-8);

      // probabilidad
      const prob = normalCdf(xvalue, mu, sigma);
      document.getElementById('output').textContent = `P(X < ${xvalue}) = ${prob.toFixed(4)} (Z = ${((xvalue-mu)/sigma).toFixed(2)})`;

      // etiqueta en cuadro
      ctx.fillStyle='rgba(255,255,255,0.85)'; ctx.fillRect(pad.l+W-220, pad.t+6, 200, 36);
      ctx.fillStyle='#111'; ctx.font='13px Inter, Arial'; ctx.textAlign='left';
      ctx.fillText(`P(X < ${xvalue}) = ${prob.toFixed(4)}`, pad.l+W-210, pad.t+28);
    }

    // eventos
    document.getElementById('plotBtn').addEventListener('click', ()=>{
      const mu = parseFloat(document.getElementById('mu').value);
      const sigma = parseFloat(document.getElementById('sigma').value);
      const xvalue = parseFloat(document.getElementById('xvalue').value);
      const range = parseFloat(document.getElementById('range').value);
      if(sigma <= 0){ alert('La desviación estándar debe ser mayor que 0'); return; }
      draw(mu, sigma, xvalue, range);
    });

    // dibujar inicialmente
    window.addEventListener('load', ()=>{
      document.getElementById('plotBtn').click();
    });
  </script>
</body>
</html>
